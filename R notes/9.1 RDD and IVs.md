## Forcing variable and cutpoint
The key feature of RDD is that there is a continuous variable Xi that determines who get treatment, denoted by Di (1 if treated).
- X is the **running/forcing variable**

## Sharp RDD
In sharp RDD, a unit is treated if Xi >= c, and not treated if Xi < c, where c is the **threshold** That is, Di is a deterministic function of Xi: Di = f(Xi). THe running variable completely decides who gets treatment.

Several assumptions must be met:
- Treatment impacts outcome, but not any other variables
- Treatment assignment happens only at 1 cutpoint value of forcing variable
- Treatment assignment is independent of potential outcomes within a narrow interval of the forcing variable around the cutpoint.
- Counterfactual outcomes can be modeled within the interval around the forcing variable's cutpoint.

Plotting a scatter graph, with cutpoint at 600:
```r
# create scatter plot with watts as forcing variable and AQI as outcome
air_scatter <- ggplot(
  data = air_data,
  aes(x=watts, y=aqi, color = group, shape = group)) + 
  geom_point() +
  geom_vline(xintercept = 600, linetype = "dashed")
```

To add separate best-fit lines for each group above/below cutpoint:
```r
# add best-fit lines to air_scatter
air_scatter2 <- air_scatter +
 geom_smooth(
  aes(group=group), #plot separate lines for each group
  method = "lm" #use linear regression
)
```

### Choosing a bandwidth
In RDD, we need to look at points near the cutpoint to find treatment & control groups that are similar. The **bandwidth** describes the distance on either side of the cutoff we should use to reduce our dataset.
- Points >1 bandwidth above and below cutpoint should be discarded
- Wide bandwidth: Keeps more of original dataset, so we have more information to estimate effect. However, treatment groups might be too different on confounding variables, reducing accuracy.
- Narrow bandwidth: Retains less of original dataset, so treatment groups become more alike. However, smaller sample size = less info to estimate treatment effect.

To calculate the **IK bandwidth** for contribution matching dataset, where `cutpoint` = 600, forcing variable = `watts` and outcome variable = `aqi` with df `air_data`:
```r
library(rdd)

# calculate IK bandwidth
cont_ik_bw <- IKbandwidth(
  X = air_data$watts, # forcing variable
  Y = air_data$aqi, # outcome variable
  cutpoint = 600 # cutpoint value
)

# print the IK bandwidth to the console
air_ik_bw
[1] 11.32436
```

### Plotting the bandwidth
To illustrate the bandwidth visually, add the bandwidth lines to the scatterplot `air_scatter` using `geom_vline()` for reference lines:
```r
air_scatter +
  geom_vline(xintercept = 600 + c(-air_ik_bw, air_ik_bw)) # add lines to indicate the bandwidth
```

### Estimating the Causal Treatment Effect
The bandwidth impacts the type of causal estimad we can calculate in a RDD. Because the RDD uses a subset of the full dataset, we can only estimate the **local average treatment effect (LATE)** -> avg treatment effect among subset of data within bandwidth.
- To estimate the LATE, a regression model allowing for different slopes on each side of the cutpoint is fit,
- Regression model used to get pred value of outcome variable for each treatment group at the cutpoint,
- Difference between pred outcome values of treatment & control groups is estimate of LATE
- However, we may not be confident that this effect (LATE) will be the same in much smaller/larger data sets.

To fit the local linear regression model with `RDestimate()` function:
```r
# fit local linear regression model
air_rdd <- RDestimate(
  formula = aqi ~ watts,
  data = air_data,
  cutpoint = 600,
  bw = air_ik_bw
```

Results:
```r
RDestimate(formula = aqi ~ watts, data = air_data, cutpoint = 600, 
    bw = air_ik_bw)

Coefficients:
     LATE    Half-BW  Double-BW  
   -36.45     -32.82     -38.14
```


## Fuzzy RDD
In fuzzy RDD, we can think of D as a random variable given X, but E[Di|Xi = c] is known to be discontinuous at c. Note that E[Di|Xi =c]=Pr[Di =1|Xi =c]
- Other variables affect treatment assignment, some of them could be unobserved
- In other words, in fuzzy RDD, X at c is a predictor of who gets treatment, but it does not completely determine assignment
